(function(){function f(a){if(!(this instanceof f))return new f(a);this.options=b.extend(!0,{},this.options);this.set_options(a);this.options.url||(this.is_loaded=!0);return this}if("undefined"!==typeof nc&&nc===nc.root){var b=nc.root.$;b(window).on("resize.modal_dialog",function(){var a=b(".nc-modal-dialog:visible").data("modal_dialog");a&&a.resize&&a.resize()});var h=null,l=function(){if(!1===b.modal.onCloseCheck())return b.modal.impl.occb=!1,b.modal.impl.bindEvents(),!1;var a=f.get_opened_dialog();
if(null!==a){var c=a.options.persist,d=b("#simplemodal-placeholder");c&&this.d.placeholder?d.replaceWith(this.d.data.removeClass("simplemodal-data").css("display",this.display)):(d.remove(),a.dialog_container.remove());b("#simplemodal-container, #simplemodal-overlay").remove();this.d={};h=null}},k=function(a){return'[data-tab-id="'+a+'"]'};f.get_opened_dialog=function(){return h&&h.is_open?h:null};f.get_current_dialog=function(){return h};f.prototype={constructor:f,options:{url:null,parameters:null,
persist:!1,confirm_close:!0,on_show:b.noop,on_resize:b.noop,on_submit_response:null,min_width:600,max_width:1200,full_markup:'<div class="nc-modal-dialog"><div class="nc-modal-dialog-header"><h2>&nbsp;</h2></div><div class="nc-modal-dialog-body"></div><div class="nc-modal-dialog-footer"></div></div>',hidden_tabs:[]},loaded_markup:null,dialog_container:null,parts:{header:".nc-modal-dialog-header",title:".nc-modal-dialog-header h2",header_tabs:".nc-modal-dialog-header-tabs",body:".nc-modal-dialog-body",
body_tabs:".nc-modal-dialog-body-tab",footer:".nc-modal-dialog-footer"},is_loaded:!1,is_open:!1,are_tabs_initialized:!1,has_header:!0,set_options:function(a){this.options=b.extend(this.options,a)},set_option:function(a,b){this.options[a]=b},load:function(){var a=this;nc.process_start("nc.ui.modal_dialog.load()");return b.get(this.options.url+"&isNaked=1",this.options.parameters||{}).done(function(c){a.loaded_markup=b.trim(c)}).always(function(){a.is_loaded=!0;nc.process_stop("nc.ui.modal_dialog.load()",
0)})},create:function(){if(!this.is_loaded)return this.load().done(b.proxy(this,"create"));var a=this.options;this.loaded_markup&&b(this.loaded_markup).is(".nc-modal-dialog")?a=b(this.loaded_markup):(a=b(a.full_markup),this.loaded_markup&&a.find(".nc-modal-dialog-body").append(this.loaded_markup));h=this;this.dialog_container=a.hide().data("modal_dialog",this).appendTo("body");this.get_part("header").length||(this.dialog_container.addClass("nc-modal-dialog-without-header"),this.has_header=!1);this.init_tabs();
this.init_form();this.init_buttons();return b.Deferred().resolve()},init_buttons:function(){var a=this,c=this.get_part("footer").find("button").off("click.modal_dialog");c.filter("[data-action=close]").on("click.modal_dialog",b.proxy(this,"close"));c.filter("[data-action=submit]").on("click.modal_dialog",function(){b(this).hasClass("nc--loading")||(nc.process_start("nc.ui.modal_dialog.submit_form()",this),a.submit_form())});if("undefined"!==typeof nc_autosave_use&&1==nc_autosave_use&&(InitAutosave("adminForm"),
null!==autosave&&"undefined"!==typeof autosave))c.filter("[data-action=save-draft]").on("click.modal_dialog",function(a){a.preventDefault();b(this).addClass("nc--loading");autosave.saveAllData(autosave)})},init_tabs:function(){if(!this.are_tabs_initialized){this.are_tabs_initialized=!0;var a=this,c=this.options.hidden_tabs,d=this.dialog_container.data("hiddenTabs");b.isArray(c)||(a.options.hidden_tabs=c?[c]:[]);d&&b.each(d.match(/[\w-]+/g),function(b,c){a.options.hidden_tabs.push(c)});c=this.get_part("body").find("[data-tab-caption]");
if(c.length){d=this.get_part("header_tabs");d.length||(d=b('<div class="nc-modal-dialog-header-tabs"/>').appendTo(this.get_part("header")));var e=d.children("ul"),f=1;e.length||(e=b("<ul/>").appendTo(d));c.addClass("nc-modal-dialog-body-tab").hide().each(function(){var c=b(this).data("tab-id")||"tab"+f++,d=b(this).attr("data-tab-id",c);b("<li>",{"data-tab-id":c,html:d.data("tab-caption")}).appendTo(e).click(function(c){a.change_tab(b(c.target).data("tab-id"))})});b.each(this.options.hidden_tabs,function(b,
c){a.hide_tab(c)});this.change_tab(c.eq(0).data("tab-id"))}}},get_form:function(){var a=this.find("#adminForm");a.length||(a=this.find("form").first());return a},init_form:function(){InitTransliterate();var a=this.get_form();if(a&&a.length){a.ajaxForm({beforeSerialize:nc_save_editor_values,success:b.proxy(this,"process_form_submit_response")});var c=a.attr("action");-1==c.indexOf("isNaked=1")&&a.attr("action",c+(0<=c.indexOf("?")?"&":"?")+"isNaked=1")}},submit_form:function(){b.modal.nc_modal_confirm=
!1;b.modal.confirmed=!0;this.get_form().submit()},process_form_submit_response:function(a,c,d,e){nc.process_stop("nc.ui.modal_dialog.submit_form()");return(b.isFunction(this.options.on_submit_response)?this.options.on_submit_response:this.default_form_submit_response_handler).call(this,a,c,d,e)},default_form_submit_response_handler:function(a,c,d,e){if(c=nc_check_error(a))this.show_error(c);else{var f=e.find("input[name=cc]").val();e=window.location;c=(c=/^NewHiddenURL=(.+?)$/m.exec(a))?b.trim(c[1]):
null;if(/^ReloadPage=1$/m.test(a))c&&!/\.php/.test(window.location.pathname)?((a=/\/([^\/]+)$/.exec(e.pathname))&&(c+=a[1]),e.pathname=c):e.reload(!0);else{var g=this;b.ajax({type:"GET",url:nc_page_url()+"&isNaked=1&admin_modal=1&cc_only="+f,success:function(a){nc_update_admin_mode_content(a,null,f);g.destroy()}})}}},show_error:function(a){var c=this.get_part("footer"),d=b("<div class='nc-alert nc--red' />").append(b("<div class='nc-alert-close nc-icon-s nc--remove'></div>").click(function(){d.remove()})).append("<i class='nc-icon-l nc--status-error'></i>").append(a).appendTo(c)},
change_tab:function(a){a=k(a);this.get_part("header_tabs").find("li").removeClass("nc--active").filter(a).addClass("nc--active").show();this.get_part("body_tabs").hide().filter(a).show();return this},hide_tab:function(a){a=k(a);this.get_part("header_tabs").find("li"+a).hide();this.get_part("body_tabs").filter(a).hide();return this},get_tab:function(a){return this.get_part("body").find(k(a))},open:function(){var a=f.get_opened_dialog();a&&a.close();this.dialog_container?this.when_ready_to_open():this.create().done(b.proxy(this,
"when_ready_to_open"));return this},when_ready_to_open:function(){b.modal(this.dialog_container,{onShow:b.proxy(this,"on_show"),onClose:l,persist:this.options.persist,closeHTML:this.has_header?'<a class="modalCloseImg" title="'+ncLang.Close+'"></a>':"",nc_confirm_close:this.options.confirm_close});this.is_open=!0;this.resize()},on_show:function(){this.options.on_show(this)},close:function(){if(this.is_open){if(!1===b.modal.onCloseCheck())return!1;b.modal.close();this.is_open=!1}},resize:function(){if(!this.is_open)return this;
var a=b(window.top.window),c=this.dialog_container.data("width"),d=this.dialog_container.data("height"),e=c||a.width()-200,f=d||a.height()-200,g=this.options;e>g.max_width&&(e=g.max_width);!c&&e<g.min_width&&(e=g.min_width);b("#simplemodal-container").css({width:e+"px",height:f+"px",left:Math.round((a.width()-e)/2-10)+"px",top:(d?(a.height()-d)/2:100)+"px"}).find(".simplemodal-wrap").css("overflow","auto");this.get_part("body").find(".nc--fill").css({width:e+"px",height:f+"px"});g.on_resize();return this},
destroy:function(){this.close();CKEDITOR&&this.dialog_container.find("textarea").each(function(){b(this).siblings(".cke_editor_"+this.name).length&&CKEDITOR.remove(CKEDITOR.instances[this.name])});this.dialog_container.remove()},clear_all:function(){for(var a in this.parts)this.clear(a)},clear_part:function(a){this.get_part(a).empty()},find:function(a){this.dialog_container||this.create();return this.dialog_container.find(a)},get_part:function(a){return this.find(this.parts[a])}};nc.ext("modal_dialog",
f,"ui")}})();
